# 解析器的后续改进路线
## 下面可选
1. 宏程序解析代码重构。
2. 流水线减少级数，最终分为文件解析和算法两级，前者决定去哪里，后者决定怎么去。
3. 算法独立成库。
4. 不要再支持刀补后的精确断点继续，刀补归入算法，属于怎么去的问题。
5. 全面使用智能指针。
6. 内存池优化，可选tcmalloc或mimalloc。
7. Fifo的模应设置为2的n次方，这样能提升速度。
8. 寻址不加同步，用户可以自己选择加或不加。
9. 用门面模式封装解析器，使解析器具有整体感，且线程安全。
10. 去除用lua脚本组装解析器的代码。
11. 预分析去掉
12. batch批处理加工去掉

## 一些问题的澄清
1. 纤程，实际是一种有栈协程，目前并没有找到更好的替代方案。C++20的是无栈协程，所以不太合适。

MFL:[Fiber实际上约等于far jump，实现时是将当前执行环境保存，恢复执行时恢复执行环境。 **请问它具体有哪些问题** ？请列出来。可供使用的第三方库包括 boost、aco等等。by MFL]

答：目前存在的最大问题是，流水线存在系统性的内存泄漏和资源泄漏。Worker的编程者，以通常的编程知识来管理内存，往往不经意之间就已经造成了泄漏，发生以后还浑然不知，且即使发现存在泄漏，也极难排查。如果要避免问题产生，编程者需要掌握额外的知识，比如流水线的构成和原理、调用Read或Write后可能上下文无法切回等，这些都是流水线的实现细节，本应被封装起来，而不是成为使用者的负担。
早前已经完成了前期改造，也就是纤程并不会被粗暴的切出而不回，而是会以异常的方式退出，这样如果再配合智能指针的全面使用，理论上就可以避免泄漏问题的发生。智能指针作为一种约束加到编程者身上是值得的，一是它本身就能极大提高安全性，是很优秀的设计，二是它的特征十分明显，方便代码检查。

2. lua真的很重。ncex格式不仅文件本身，背后还有大量的代码都是由lua写成的，这些代码不在刀路中，却被刀路引用。所以不太能去除。

3. 解析和执行加工，不太能保证实时性，即使是把fifo设置为最小。
